<%= render_layout "layout", {
      :strip_collection => @strip.strip_collection, 
      :title => @strip.title,
    } do %>
  <div id="ctitle">
    <%= @strip.title %>
    (<%= @pagination.index + 1 %> de <%= @pagination.total %>)
  </div>
  
  <ul class="comic-nav">
    <li><%= link_to "|<", strip_path(@pagination.first), :accesskey => "f" %></li>
    <li><%= link_to "< Anterior", strip_path(@pagination.previous), :accesskey => "p" %></li>
    <li><%= link_to "Aleatorio", random_path_for_collection_strip(@strip), :accesskey => "r" %></li>
    <li><%= link_to "Siguiente >", strip_path(@pagination.next), :accesskey => "n" %></li>
    <li><%= link_to ">|", strip_path(@pagination.last), :accesskey => "l" %></li>
  </ul>
  
  <div id="comic">
    <%= image_tag @strip.image.url, :width => "800", :height => "228" %>
  </div>
  
  <div id="transcript" class="<%= current_user ? 'editable' : '' %>">
    <div class="toggle-edit">
      <%= content_tag(:pre, @strip.text, class: "text") %>
     
      <% if user_signed_in? %>
        <%= link_to "Editar", "#", :accesskey => "e", :"data-toggle" => ".toggle-edit" %>
      <% else %>
        <%= link_to "Entrar para editar", signin_path %>
      <% end %>
      <%= link_to_history(@strip) %>
    </div>

    <% if user_signed_in? %>
      <%= form_for @strip.transcripts.new(:text => @strip.text), 
            :url => polymorphic_path([@strip.strip_collection, @strip, :transcripts]),
            :html => {:class => "toggle-edit", :style => "display: none"} do |form|%>
        <%= form.text_area :text %>
        <%= form.submit "Guardar" %>
        
        <%= link_to "Cancelar", "#", :accesskey => "c", :"data-toggle" => ".toggle-edit" %>
        <%= link_to_history(@strip) %>
      <% end %>
    <% end %>

    <% if @strip.transcripts.count > 0 %>
      <div id="history">
        <div id="transcript-history" style="display: none">
          <ul>
            <% @strip.transcripts.joins(:user).by_version(:asc).
                 map.with_index.reverse_each do |transcript, idx| %>
              <li>
                <%= idx + 1 %>.
                <%= transcript.user.name %> -
                <%= transcript.created_at.utc.strftime("%d/%m/%Y %H:%M UTC") %>
                -
                <%= link_to "texto", "javascript:void()", 
                      :"data-toggle" => "#transcript-#{transcript.id}" %>
                <%= content_tag(:pre, transcript.text, 
                      :id => "transcript-#{transcript.id}", 
                      :style => "display:none") %>   
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
